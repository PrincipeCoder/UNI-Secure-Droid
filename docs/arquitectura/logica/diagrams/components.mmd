flowchart LR
    %% ======================
    %% COMPONENTES PRINCIPALES
    %% ======================

    U[UploadService]:::svc
    S[StaticAnalyzer]:::svc
    D[DynamicRunner]:::svc
    F[FeatureBuilder]:::svc
    M[ModelService]:::svc
    R[ReportService]:::svc
    A[AuthZService]:::infra
    Q[JobQueue]:::infra
    O[ObjectStore]:::infra
    DB[MetadataDB]:::infra

    %% ======== FLUJO BÁSICO ========
    U -->|Valida y encola| Q
    Q -->|job estático| S
    S -->|features estáticas| F
    F -->|vector| M
    M -->|veredicto| R

    %% ======== FLUJO CON INCERTIDUMBRE ========
    M -- "score incierto" --> D
    D -->|features dinámicas| F

    %% ======== ALMACENAMIENTO Y METADATA ========
    U -->|guarda APK| O
    S -->|logs| DB
    D -->|trazas dinámicas| O
    F -->|vector final| DB
    R -->|reporte| O

    %% ======== AUTORIZACIÓN ========
    A -.-> U
    A -.-> R
    A -.-> Q

    %% ======== ESTILOS ========
    classDef svc fill:#bbdefb,stroke:#1a237e,color:#0d47a1;
    classDef infra fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20;
